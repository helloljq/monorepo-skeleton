# RBAC 权限管理系统

> 创建日期: 2025-12-24
> 状态: 设计中
> 负责人: -

## 概述

设计并实现一套完整的基于角色的访问控制 (Role-Based Access Control, RBAC) 系统，支持多种登录方式的统一身份管理。

## 需求背景

### 业务需求

1. **多登录方式支持**: 用户可以通过以下方式登录系统
   - 邮箱 + 密码
   - 手机号 + 短信验证码
   - 微信扫码登录 (PC 端)
   - 微信网页授权登录 (H5)
   - 微信小程序登录

2. **账号绑定**: 同一用户可以绑定多种登录方式，实现一个账号多入口登录

3. **角色管理**: 支持灵活的角色定义和分配
   - 内置系统角色 (超级管理员、普通用户等)
   - 自定义业务角色
   - 用户可拥有多个角色

4. **权限控制**: 细粒度的资源访问控制
   - API 级别的权限控制
   - 数据级别的权限控制 (可选)
   - 菜单/按钮级别的前端权限 (可选)

### 技术需求

1. 与现有 JWT 双 Token 认证体系兼容
2. 权限验证高性能，支持缓存
3. 支持动态权限变更
4. 完整的审计日志
5. 向后兼容现有用户数据

## 核心功能

### P0 - 必须实现

- [ ] 多登录方式身份体系 (User + UserIdentity)
- [ ] 角色管理 (Role CRUD)
- [ ] 权限定义 (Permission CRUD)
- [ ] 角色-权限关联
- [ ] 用户-角色关联
- [ ] 权限检查 Guard (`@RequirePermissions()`)
- [ ] 角色检查 Guard (`@RequireRoles()`)
- [ ] 权限缓存机制

### P1 - 应该实现

- [ ] 微信登录集成 (扫码/网页/小程序)
- [ ] 手机号登录 (短信验证码)
- [ ] 账号合并/解绑功能
- [ ] 权限管理后台 API
- [ ] 角色继承

### P2 - 可选实现

- [ ] 数据权限 (行级/字段级)
- [ ] 权限组/权限模板
- [ ] 权限审批流程
- [ ] 临时权限授予

## 相关文档

- [数据库设计](./schema.md)
- [实现方案](./implementation_plan.md)
