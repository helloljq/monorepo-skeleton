# 导航模块功能

> 创建日期: 2025-12-25
> 状态: 已完成
> 负责人: -

## 概述

设计并实现一个导航页面模块，支持管理员设置公共导航和用户自定义个人导航，用于前端呈现统一的导航入口页面。

## 需求背景

### 核心场景

用户需要一个统一的导航页面，快速访问常用链接和工具：

1. **公共导航**：管理员统一配置系统级导航（如常用工具、公司内部系统入口）
2. **个人导航**：用户可添加个人常用链接到自己的分组中
3. **分组管理**：导航项按分组组织，便于分类浏览
4. **排序支持**：分组和导航项均支持自定义排序

### 设计决策

| 维度         | 决策                                                     |
| ------------ | -------------------------------------------------------- |
| **分组归属** | 用户仅限在个人分组中添加导航项，公共分组完全由管理员管理 |
| **图标格式** | 兼容图标名称（如 `home`）和 URL（如 CDN 链接）两种格式   |
| **公开访问** | 支持未登录用户查看公共导航                               |
| **数量限制** | 不限制个人导航的数量                                     |

## 核心功能需求

1. **导航分组管理**：创建、编辑、删除、排序分组
2. **导航项管理**：创建、编辑、删除、排序导航项
3. **公共导航**：管理员管理，所有用户可见（包括未登录用户）
4. **个人导航**：用户自行管理，仅本人可见
5. **合并查询**：登录用户获取公共+个人的合并导航列表
6. **缓存策略**：Redis 缓存公共导航和用户导航

## 验收标准

### 基础功能

- [x] 完成数据库模型设计与迁移（NavigationGroup, NavigationItem）
- [x] 完成软删除集成 (`SOFT_DELETE_MODELS` + `soft-delete-check`)
- [x] 实现管理员导航分组 CRUD API
- [x] 实现管理员导航项 CRUD API
- [x] 实现用户个人分组 CRUD API
- [x] 实现用户个人导航项 CRUD API
- [x] 实现公共导航查询接口（@Public）
- [x] 实现合并导航查询接口
- [x] 实现批量排序功能
- [x] 实现 Redis 缓存策略
- [x] 添加错误码到 `error-codes.ts`（16000-16999）

### 权限控制

- [x] 管理员接口权限控制（navigation:group:_, navigation:item:_）
- [x] 用户个人导航所有权校验
- [x] 公共导航接口无需登录

### 测试覆盖

- [x] 完成 Service 单元测试
- [x] 完成缓存服务单元测试
- [ ] 完成 E2E 测试（鉴权失败 401 + DTO 校验失败 400）

### 文档

- [x] 完成 Swagger API 文档（包含响应类型 DTO）

## 技术说明

### 唯一性约束

由于 PostgreSQL 中 `NULL` 不参与唯一约束，系统导航分组的 `code` 唯一性通过 Service 层显式校验实现：

- 系统分组：`code` + `userId=null` 组合唯一
- 用户分组：`code` + `userId` 组合唯一

### 错误码分配

```
// 16000-16999: Navigation 域

// 分组相关 (160xx)
NAV_GROUP_NOT_FOUND: 16001
NAV_GROUP_CODE_EXISTS: 16002
NAV_GROUP_NOT_OWNER: 16003
NAV_GROUP_HAS_ITEMS: 16004

// 导航项相关 (161xx)
NAV_ITEM_NOT_FOUND: 16010
NAV_ITEM_NOT_OWNER: 16011
NAV_ITEM_INVALID_GROUP: 16012
```

## 相关文档

- [实现方案](./implementation-plan.md)
